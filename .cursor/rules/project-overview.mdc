---
description: spaceduck project overview and architecture
globs: "**/*.ts"
alwaysApply: true
---

# spaceduck

A modular, open-source AI chat assistant built with Bun. Monorepo with workspace packages.

Always spell spaceduck with lowercase.

Never add "Made with Cursor" anywhere.

## Architecture

- `@spaceduck/core` — zero-dependency contract package (types, interfaces, agent loop, context builder, events, middleware)
- `@spaceduck/gateway` — composition root that wires everything together, lifecycle orchestration
- `@spaceduck/config` — Zod-based config schema, hot-apply, model pricing
- `@spaceduck/scheduler` — task scheduler, persistent queue, budget guards (per-task + global), task runner
- `@spaceduck/skills` — skill runtime: SKILL.md parser, security scanner, registry with cascading memory purge
- `@spaceduck/ui` — shared React components, hooks, and styles (used by web + desktop)
- `@spaceduck/web` — web deployment entry point (served by gateway via Bun HTML import)
- `@spaceduck/desktop` — Tauri v2 desktop app (embeds UI + Bun gateway sidecar)
- `@spaceduck/provider-gemini` — Google AI Studio (Gemini) streaming adapter (primary)
- `@spaceduck/provider-bedrock` — AWS Bedrock Converse API streaming adapter (secondary)
- `@spaceduck/memory-sqlite` — SQLite storage via Bun.SQL (ConversationStore + LongTermMemory)

## Key principles

- Core has ZERO external dependencies. All other packages depend only on core.
- Gateway is the composition root — it creates instances and wires dependencies.
- Dependency inversion everywhere: code against interfaces, not implementations.
- Use `Result<T, E>` for expected failures, exceptions for bugs.
- Every resource-owning component implements `Lifecycle` (start/stop, idempotent).
- Structured logging via `Logger` interface — no `console.log` in library code.
- EventBus for cross-cutting concerns (fact extraction, analytics, logging).
- Middleware pipeline for pre/post-processing (rate limiting, filtering, audit).

## Conventions

- Use Bun-native APIs wherever possible (Bun.serve, Bun.SQL, bun:test, Bun.env).
- TypeScript strict mode. No `any`. Explicit return types on public APIs.
- Exports from each package go through `src/index.ts`.
